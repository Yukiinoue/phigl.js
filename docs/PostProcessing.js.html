<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: PostProcessing.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: PostProcessing.js</h1>

    


    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>phina.namespace(function() {

  /**
   * @constructor phigl.PostProcessing
   */
  phina.define("phigl.PostProcessing", {

    /**
     * @memberOf phigl.PostProcessing.prototype
     */
    gl: null,
    /**
     * @memberOf phigl.PostProcessing.prototype
     */
    drawer: null,

    /**
     * @memberOf phigl.PostProcessing.prototype
     */
    width: 0,
    /**
     * @memberOf phigl.PostProcessing.prototype
     */
    height: 0,

    init: function(gl, shader, uniforms, width, height) {
      this.gl = gl;

      if (typeof(shader) == "string") {
        shader = phigl.PostProcessing.createProgram(gl, shader);
      }
      width = width || 256;
      height = height || 256;
      uniforms = uniforms || [];

      var sqWidth = Math.pow(2, Math.ceil(Math.log2(width)));
      var sqHeight = Math.pow(2, Math.ceil(Math.log2(height)));

      this.drawer = phigl.Drawable(gl)
        .setDrawMode(gl.TRIANGLE_STRIP)
        .setProgram(shader)
        .setIndexValues([0, 1, 2, 3])
        .setAttributes("position", "uv")
        .setAttributeData([
          //
          -1, +1, 0, height / sqHeight,
          //
          +1, +1, width / sqWidth, height / sqHeight,
          //
          -1, -1, 0, 0,
          // 
          +1, -1, width / sqWidth, 0,
        ])
        .setUniforms(["texture", "canvasSize"].concat(uniforms));

      this.width = width;
      this.height = height;
      this.sqWidth = sqWidth;
      this.sqHeight = sqHeight;
    },

    /**
     * @memberOf phigl.PostProcessing.prototype
     */
    render: function(texture, uniformValues) {
      var gl = this.gl;

      this.drawer.uniforms.texture.setValue(0).setTexture(texture);
      this.drawer.uniforms.canvasSize.value = [this.sqWidth, this.sqHeight];
      if (uniformValues) this.setUniforms(uniformValues);
      this.drawer.draw();

      return this;
    },

    /**
     * @memberOf phigl.PostProcessing.prototype
     */
    setUniforms: function(uniformValues) {
      var uniforms = this.drawer.uniforms;
      uniformValues.forIn(function(k, v) {
        uniforms[k].value = v;
      });
    },

    /**
     * @memberOf phigl.PostProcessing.prototype
     */
    calcCoord: function(x, y) {
      return [x / this.sqWidth, (this.height - y) / this.sqHeight];
    },

    _static: {
      /**
       * @memberOf phigl.PostProcessing
       */
      vertexShaderSource: [
        "attribute vec2 position;",
        "attribute vec2 uv;",

        "varying vec2 vUv;",

        "void main(void) {",
        "  vUv = uv;",
        "  gl_Position = vec4(position, 0.0, 1.0);",
        "}",
      ].join("\n"),

      /**
       * @memberOf phigl.PostProcessing
       */
      createProgram: function(gl, fragmentShader) {
        var vertexShader = phigl.VertexShader(gl);
        vertexShader.data = this.vertexShaderSource;

        return phigl.Program(gl)
          .attach(vertexShader)
          .attach(fragmentShader)
          .link();
      },
    },

  });

});
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Index</a></h2><h3>Classes</h3><ul><li><a href="phigl.Attribute.html">Attribute</a></li><li><a href="phigl.Detector.html">Detector</a></li><li><a href="phigl.Drawable.html">Drawable</a></li><li><a href="phigl.Extensions.html">Extensions</a></li><li><a href="phigl.FragmentShader.html">FragmentShader</a></li><li><a href="phigl.Framebuffer.html">Framebuffer</a></li><li><a href="phigl.Ibo.html">Ibo</a></li><li><a href="phigl.ImageUtil.html">ImageUtil</a></li><li><a href="phigl.InstancedDrawable.html">InstancedDrawable</a></li><li><a href="phigl.PostProcessing.html">PostProcessing</a></li><li><a href="phigl.Program.html">Program</a></li><li><a href="phigl.Shader.html">Shader</a></li><li><a href="phigl.Texture.html">Texture</a></li><li><a href="phigl.Uniform.html">Uniform</a></li><li><a href="phigl.Vbo.html">Vbo</a></li><li><a href="phigl.VertexShader.html">VertexShader</a></li></ul>
</nav>

<br clear="both">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.3.0-alpha5</a> on Tue Dec 27 2016 13:45:14 GMT+0900 (東京 (標準時))
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
